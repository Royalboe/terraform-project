module "network" {
  source = ./modules/network
}

module "ssh_key" {
  source = ./modules/ssh-key
}

module "servers" {
  source = ./modules/servers
  key_name = module.key-pair.key_name
  pub_subnet_1 = module.network.pub_subnet_id_1
  pub_subnet_2 = module.network.pub_subnet_id_2
  pub_subnet_3 = module.network.pub_subnet_id_3
  vpc_id = module.network.vpc_id
  web_server_SG = module.network.web_server_SG
  availability_zones = var.availability_zones
  namespace = var.namespace
}

module "load_balancer" {
  source = ./modules/load-balancer
  lb_name = var.lb_name
  vpc_id = module.network.vpc_id
  public_subnets = module.network.public_subnets
  web_ids = module.servers.web_ids
  lb_sec_grps = module.network.lb_sec_grps
  namespace = var.namespace
}

module "route53" {
  source = ./modules/route53
  domain = var.domain
  vpc_id = module.network.vpc_id
  lb_dns_name = module.servers.lb_dns_name
  alb_zone_id = module.servers.alb_zone_id
}